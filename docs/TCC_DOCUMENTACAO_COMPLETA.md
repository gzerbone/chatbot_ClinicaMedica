# ğŸ“š DocumentaÃ§Ã£o Completa - Sistema de Chatbot para ClÃ­nica MÃ©dica

> DocumentaÃ§Ã£o TÃ©cnica e AcadÃªmica Consolidada  
> Desenvolvido como Trabalho de ConclusÃ£o de Curso (TCC)  
> Ãšltima atualizaÃ§Ã£o: Novembro de 2025

---

## ğŸ¯ VisÃ£o Geral do Sistema

Este documento apresenta a documentaÃ§Ã£o completa do **Sistema de Chatbot Inteligente para GestÃ£o de Agendamentos em ClÃ­nica MÃ©dica**, desenvolvido utilizando tecnologias modernas de InteligÃªncia Artificial e integraÃ§Ã£o com plataformas de mensageria.

### Objetivo do Sistema

O sistema foi desenvolvido para automatizar e otimizar o processo de agendamento de consultas mÃ©dicas atravÃ©s do WhatsApp, oferecendo uma interface conversacional inteligente que:

- **Compreende** intenÃ§Ãµes do usuÃ¡rio em linguagem natural
- **Extrai** informaÃ§Ãµes relevantes automaticamente
- **Gerencia** o fluxo de conversaÃ§Ã£o de forma contextual
- **Integra** com sistemas externos (Google Calendar, WhatsApp Business API)
- **Facilita** o handoff para atendimento humano quando necessÃ¡rio

### Tecnologias Principais

- **Backend**: Python 3.11+ com Django Framework
- **InteligÃªncia Artificial**: Google Gemini AI (LLM)
- **Banco de Dados**: SQLite (desenvolvimento) / PostgreSQL (produÃ§Ã£o)
- **Mensageria**: WhatsApp Business API
- **IntegraÃ§Ã£o de Agenda**: Google Calendar API
- **Arquitetura**: Modular e baseada em serviÃ§os

---

## ğŸ“‚ Estrutura da DocumentaÃ§Ã£o

Esta documentaÃ§Ã£o estÃ¡ organizada em seÃ§Ãµes especializadas para facilitar a navegaÃ§Ã£o e compreensÃ£o:

### 1. ğŸ—ï¸ Arquitetura do Sistema

- **[Arquitetura Geral](./01_arquitetura/ARQUITETURA_ATUAL.md)**
  - VisÃ£o macro do sistema
  - Componentes principais
  - Fluxo de dados end-to-end
  
- **[OrganizaÃ§Ã£o do Banco de Dados](./01_arquitetura/ORGANIZACAO_BANCO_DADOS.md)**
  - Modelo de dados
  - Relacionamentos entre entidades
  - Estrutura de tabelas

- **[Arquitetura Modular Gemini](./01_arquitetura/ARQUITETURA_GEMINI_CENTRALIZADA.md)**
  - MÃ³dulos especializados de IA
  - Responsabilidades de cada mÃ³dulo
  - IntegraÃ§Ã£o entre mÃ³dulos

### 2. ğŸ¤– Agent Router - Sistema de Roteamento Inteligente

- **[DocumentaÃ§Ã£o Completa do Agent Router](./08_agent_router/AGENT_ROUTER_COMPLETO.md)**
  - Conceito de Agent Router
  - Justificativa de implementaÃ§Ã£o
  - Tipos de roteamento utilizados
  - Arquitetura detalhada

- **[ImplementaÃ§Ã£o TÃ©cnica](./08_agent_router/IMPLEMENTACAO_TECNICA_ROUTER.md)**
  - Estrutura de cÃ³digo
  - Fluxo de processamento
  - DecisÃµes de roteamento
  - IntegraÃ§Ã£o com serviÃ§os

- **[Diagramas Visuais](./08_agent_router/DIAGRAMAS_VISUAIS.md)**
  - Diagramas de fluxo completos
  - Ãrvores de decisÃ£o
  - Ciclo de vida de mensagens

### 3. ğŸ”„ Fluxos e Processos

- **[Fluxo Completo do Projeto](./04_fluxos_processos/FLUXO_COMPLETO_PROJETO.md)**
  - Arquitetura modularizada
  - Fluxo de dados detalhado
  - MÃ³dulos Gemini e serviÃ§os

- **[AnÃ¡lise de Estados da ConversaÃ§Ã£o](./04_fluxos_processos/ANALISE_ESTADOS_CONVERSACAO.md)**
  - MÃ¡quina de estados
  - TransiÃ§Ãµes entre estados
  - Sistema de pausar/retomar

- **[LÃ³gica de PrÃ©-Agendamento](./04_fluxos_processos/LOGICA_PRE_AGENDAMENTO_ATUALIZADA.md)**
  - Fluxo completo de agendamento
  - ValidaÃ§Ãµes em cada etapa
  - GeraÃ§Ã£o de handoff

- **[Sistema de DÃºvidas e Pausar/Retomar](./04_fluxos_processos/SISTEMA_DUVIDAS_PAUSAR_RETOMAR.md)**
  - Gerenciamento de contexto
  - Pausar agendamento para responder dÃºvidas
  - Retomada contextual

### 4. ğŸ“Š Diagramas UML e Modelagem

- **[Diagramas de Casos de Uso](#diagramas-de-casos-de-uso)**
- **[Diagramas de Atividade](#diagramas-de-atividade)**
- **[Diagramas de SequÃªncia](#diagramas-de-sequÃªncia)**
- **[Diagrama de Classes](#diagrama-de-classes)**
- **[Diagrama de Estados](#diagrama-de-estados)**

---

## ğŸ­ Diagramas de Casos de Uso

### Atores do Sistema

1. **Paciente**: UsuÃ¡rio que interage com o chatbot via WhatsApp
2. **SecretÃ¡ria**: Profissional que recebe handoffs e finaliza agendamentos
3. **Sistema Google Calendar**: Sistema externo de gerenciamento de agenda
4. **Sistema Gemini AI**: ServiÃ§o de InteligÃªncia Artificial

### Casos de Uso Principais

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    CASOS DE USO DO SISTEMA                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                     â•‘
â•‘   ğŸ‘¤ Paciente                                                      â•‘
â•‘   â”œâ”€â”€ UC01: Iniciar Conversa                                       â•‘
â•‘   â”œâ”€â”€ UC02: Solicitar InformaÃ§Ãµes sobre ClÃ­nica                    â•‘
â•‘   â”œâ”€â”€ UC03: Consultar Especialidades DisponÃ­veis                   â•‘
â•‘   â”œâ”€â”€ UC04: Consultar MÃ©dicos DisponÃ­veis                          â•‘
â•‘   â”œâ”€â”€ UC05: Consultar HorÃ¡rios DisponÃ­veis                         â•‘
â•‘   â”œâ”€â”€ UC06: Agendar Consulta                                       â•‘
â•‘   â”‚   â”œâ”€â”€ UC06.1: Informar Nome Completo                           â•‘
â•‘   â”‚   â”œâ”€â”€ UC06.2: Confirmar Nome                                   â•‘
â•‘   â”‚   â”œâ”€â”€ UC06.3: Selecionar Especialidade                         â•‘
â•‘   â”‚   â”œâ”€â”€ UC06.4: Selecionar MÃ©dico                                â•‘
â•‘   â”‚   â”œâ”€â”€ UC06.5: Selecionar Data                                  â•‘
â•‘   â”‚   â”œâ”€â”€ UC06.6: Selecionar HorÃ¡rio                               â•‘
â•‘   â”‚   â””â”€â”€ UC06.7: Confirmar Agendamento                            â•‘
â•‘   â”œâ”€â”€ UC07: Tirar DÃºvidas Durante Agendamento                      â•‘
â•‘   â”œâ”€â”€ UC08: Retomar Agendamento Pausado                            â•‘
â•‘   â””â”€â”€ UC09: Cancelar Agendamento                                   â•‘
â•‘                                                                     â•‘
â•‘   ğŸ‘©â€ğŸ’¼ SecretÃ¡ria                                                    â•‘
â•‘   â”œâ”€â”€ UC10: Receber Handoff de Agendamento                         â•‘
â•‘   â”œâ”€â”€ UC11: Validar Disponibilidade Real                           â•‘
â•‘   â”œâ”€â”€ UC12: Confirmar Agendamento Final                            â•‘
â•‘   â””â”€â”€ UC13: Registrar Consulta no Sistema                          â•‘
â•‘                                                                     â•‘
â•‘   ğŸ¤– Sistema                                                        â•‘
â•‘   â”œâ”€â”€ UC14: Detectar IntenÃ§Ã£o do UsuÃ¡rio                           â•‘
â•‘   â”œâ”€â”€ UC15: Extrair Entidades da Mensagem                          â•‘
â•‘   â”œâ”€â”€ UC16: Gerenciar Estado da ConversaÃ§Ã£o                        â•‘
â•‘   â”œâ”€â”€ UC17: Consultar Disponibilidade no Google Calendar           â•‘
â•‘   â”œâ”€â”€ UC18: Gerar Link de Handoff                                  â•‘
â•‘   â””â”€â”€ UC19: Gerar Resposta Contextual                              â•‘
â•‘                                                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Diagrama de Caso de Uso: Agendamento de Consulta

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   SISTEMA DE AGENDAMENTO            â”‚
                    â”‚   DE CONSULTAS MÃ‰DICAS              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                           â”‚                           â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Informarâ”‚                 â”‚Selecionarâ”‚              â”‚Selecionarâ”‚
    â”‚  Nome  â”‚                 â”‚Especiali-â”‚              â”‚  MÃ©dico  â”‚
    â”‚        â”‚                 â”‚  dade    â”‚              â”‚          â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                           â”‚                           â”‚
        â”‚                           â”‚                           â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Confirmarâ”‚                â”‚Selecionarâ”‚              â”‚Confirmar â”‚
    â”‚  Nome  â”‚                 â”‚   Data   â”‚              â”‚Agendamen-â”‚
    â”‚        â”‚                 â”‚          â”‚              â”‚    to    â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                           â”‚                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ Gerar Handoff  â”‚
                            â”‚ para SecretÃ¡riaâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ‘¤ Paciente                                        ğŸ‘©â€ğŸ’¼ SecretÃ¡ria
    â”‚                                                  â”‚
    â”‚ Envia mensagem                                   â”‚
    â”‚ via WhatsApp                                     â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                             â”‚
    â”‚                    ğŸ¤–                             â”‚
    â”‚                  Sistema                          â”‚
    â”‚                    â”‚                             â”‚
    â”‚                    â”‚ Processa com IA             â”‚
    â”‚                    â”‚ e gerencia fluxo            â”‚
    â”‚                    â”‚                             â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
    â”‚ Recebe resposta    â”‚                             â”‚
    â”‚                    â”‚                             â”‚
    â”‚                    â”‚ Gera handoff                â”‚
    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚
    â”‚                                       Recebe linkâ”‚
    â”‚                                       de handoff â”‚
    â”‚                                                  â”‚
```

---

## ğŸ“Š Diagramas de Atividade

### Fluxo Principal: Processamento de Mensagem

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   INÃCIO    â”‚
                        â”‚  (Mensagem  â”‚
                        â”‚   recebida) â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Validar formato da      â”‚
                        â”‚ mensagem (apenas texto) â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ VÃ¡lida?             â”‚
                    â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                  NÃ£o  â”‚              â”‚ Sim
                â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”         â”‚
                â”‚  Retornar â”‚         â”‚
                â”‚   erro    â”‚         â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                                â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ Obter/Criar SessÃ£o    â”‚
                                â”‚ do usuÃ¡rio            â”‚
                                â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ Obter histÃ³rico de    â”‚
                                â”‚ conversaÃ§Ã£o           â”‚
                                â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ Detectar IntenÃ§Ã£o     â”‚
                                â”‚ (IntentDetector)      â”‚
                                â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ Extrair Entidades     â”‚
                                â”‚ (EntityExtractor)     â”‚
                                â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Analisar estado atual     â”‚
                        â”‚ e determinar prÃ³xima aÃ§Ã£o â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Qual intenÃ§Ã£o detectada?      â”‚
                        â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚         â”‚          â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ saudacao     â”‚   â”‚buscar_  â”‚  â”‚agendar_    â”‚
            â”‚              â”‚   â”‚info     â”‚  â”‚consulta    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚         â”‚          â”‚
                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                    â”‚ Gerar Resposta Contextual      â”‚
                    â”‚ (ResponseGenerator)            â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Atualizar estado da       â”‚
                    â”‚ sessÃ£o                    â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Salvar mensagens no       â”‚
                    â”‚ histÃ³rico                 â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Enviar resposta via       â”‚
                    â”‚ WhatsApp API              â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                        â”Œâ”€â–¼â”€â”€â”€â”€â”
                        â”‚ FIM  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”˜
```

### Fluxo de Agendamento Completo

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   INÃCIO    â”‚
                        â”‚ (UsuÃ¡rio    â”‚
                        â”‚ quer agendarâ”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Estado: idle            â”‚
                        â”‚ â†’ collecting_patient_   â”‚
                        â”‚    info                 â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Solicitar nome completo â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ UsuÃ¡rio informa nome    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Extrair nome da mensagemâ”‚
                        â”‚ (EntityExtractor)       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Nome extraÃ­do?      â”‚
                    â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                  NÃ£o  â”‚              â”‚ Sim
                â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Solicitar â”‚    â”‚ Estado: confirming_  â”‚
                â”‚ novamente â”‚    â”‚ name                 â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ "Confirma se seu nome â”‚
                                â”‚  Ã© {nome}?"           â”‚
                                â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ UsuÃ¡rio confirma? â”‚
                            â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                          NÃ£o  â”‚           â”‚ Sim
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Solicitar â”‚    â”‚ Salvar nome       â”‚
                    â”‚ novamente â”‚    â”‚ confirmado        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Estado: selecting_  â”‚
                                    â”‚ specialty           â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ "Qual especialidade â”‚
                                    â”‚  vocÃª procura?"     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ UsuÃ¡rio informa     â”‚
                                    â”‚ especialidade       â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Estado: selecting_  â”‚
                                    â”‚ doctor              â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Listar mÃ©dicos da   â”‚
                                    â”‚ especialidade       â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ UsuÃ¡rio seleciona   â”‚
                                    â”‚ mÃ©dico              â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Estado: choosing_   â”‚
                                    â”‚ schedule            â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Consultar Google    â”‚
                                    â”‚ Calendar            â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Exibir horÃ¡rios     â”‚
                                    â”‚ disponÃ­veis         â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ UsuÃ¡rio seleciona   â”‚
                                    â”‚ data e horÃ¡rio      â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Estado: confirming  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Exibir resumo e     â”‚
                                    â”‚ solicitar confirmaÃ§Ã£oâ”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ UsuÃ¡rio confirma?           â”‚
                            â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                          NÃ£o  â”‚                      â”‚ Sim
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Voltar ao â”‚              â”‚ Gerar handoff   â”‚
                    â”‚ passo      â”‚              â”‚ link            â”‚
                    â”‚ desejado   â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚ Enviar link paraâ”‚
                                                â”‚ secretÃ¡ria      â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                    â”Œâ”€â”€â–¼â”€â”€â”
                                                    â”‚ FIM â”‚
                                                    â””â”€â”€â”€â”€â”€â”˜
```

### Fluxo de Sistema de Pausar/Retomar (DÃºvidas)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ UsuÃ¡rio em       â”‚
                    â”‚ processo de      â”‚
                    â”‚ agendamento      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ UsuÃ¡rio faz uma         â”‚
                â”‚ pergunta/dÃºvida         â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Sistema detecta intenÃ§Ã£o â”‚
                â”‚ "buscar_info" ou "duvida"â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Estado atual != idle ou     â”‚
                â”‚ answering_questions?        â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                 NÃ£o â”‚                   â”‚ Sim
                     â”‚            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚            â”‚ Salvar estado atualâ”‚
                     â”‚            â”‚ em previous_state  â”‚
                     â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                   â”‚
                     â”‚            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚            â”‚ Mudar estado para  â”‚
                     â”‚            â”‚ answering_questionsâ”‚
                     â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                         â”‚
                                  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ Responder dÃºvida   â”‚
                                  â”‚ usando RAG         â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ Aguardar prÃ³xima   â”‚
                                  â”‚ mensagem do usuÃ¡rioâ”‚
                                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ UsuÃ¡rio diz "continuar",  â”‚
                            â”‚ "retomar" ou "voltar"?    â”‚
                            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                             NÃ£o â”‚                â”‚ Sim
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Responder novaâ”‚      â”‚ Restaurar estado   â”‚
                    â”‚ dÃºvida        â”‚      â”‚ anterior de        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ previous_state     â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                           â”‚ Limpar previous_   â”‚
                                           â”‚ state              â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                           â”‚ Continuar processo â”‚
                                           â”‚ de agendamento de  â”‚
                                           â”‚ onde parou         â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Diagramas de SequÃªncia

### SequÃªncia: Processamento de Mensagem Completo

```
UsuÃ¡rio      WhatsApp API    View (Django)    CoreService    IntentDetector    EntityExtractor    ResponseGenerator    Database
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚ Envia msg    â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚ POST /webhook   â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚ Valida formato â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚ get_session()  â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚              â”‚                 â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚              â”‚                 â”‚                â”‚ Session data   â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚ detect_intent()â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚ Chama Gemini AI â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚ Intent + conf. â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚ extract_entities()               â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚ Chama Gemini AI   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚ Entities dict  â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚ generate_response()              â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚ Query data   â”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
  â”‚              â”‚                 â”‚                â”‚ Response text  â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”‚ update_session()                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚              â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚                 â”‚ Response       â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
  â”‚ Recebe resp  â”‚                 â”‚                â”‚                â”‚                 â”‚                   â”‚              â”‚
```

### SequÃªncia: Fluxo de Agendamento com Handoff

```
Paciente    ChatBot    ConversationService    SmartScheduling    GoogleCalendar    HandoffService    SecretÃ¡ria
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚  "Quero   â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚  agendar" â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚ get_session() â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚  "Qual seu    â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   nome?"      â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚ "JoÃ£o Silva"              â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚ extract_name()â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚  "Confirma    â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   JoÃ£o Silva?"â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚ "Sim"     â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚ confirm_name()â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚  "Qual        â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   mÃ©dico?"    â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚ "Dr. Carlos"              â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚ get_doctor()  â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚  get_availability()  â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚              â”‚
   â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚  "HorÃ¡rios:   â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   14h, 15h"   â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚ "14h"     â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚  "Confirma    â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   agendamento?"                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚ "Sim"     â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚ generate_handoff()                   â”‚                 â”‚                â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚
   â”‚           â”‚                                       â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚                                       â”‚                 â”‚  Send link     â”‚              â”‚
   â”‚           â”‚                                       â”‚                 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚  "Link:       â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   http://..." â”‚                      â”‚                 â”‚                â”‚              â”‚
   â”‚           â”‚               â”‚                      â”‚                 â”‚                â”‚              â”‚
```

---

## ğŸ“¦ Diagrama de Classes Simplificado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CAMADA DE SERVIÃ‡OS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  GeminiChatbotService (CoreService)                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  - api_key: str                                          â”‚  â”‚
â”‚  â”‚  - enabled: bool                                         â”‚  â”‚
â”‚  â”‚  - intent_detector: IntentDetector                       â”‚  â”‚
â”‚  â”‚  - entity_extractor: EntityExtractor                     â”‚  â”‚
â”‚  â”‚  - response_generator: ResponseGenerator                 â”‚  â”‚
â”‚  â”‚  - session_manager: SessionManager                       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  + process_message(phone, message): Dict                 â”‚  â”‚
â”‚  â”‚  + _handle_patient_name_flow(): Dict                     â”‚  â”‚
â”‚  â”‚  + _handle_scheduling_request(): Dict                    â”‚  â”‚
â”‚  â”‚  + _get_clinic_data_optimized(): Dict                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                    â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚          â”‚                 â”‚                 â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚IntentDetector  â”‚ â”‚EntityExtrac-â”‚ â”‚ResponseGeneratorâ”‚       â”‚
â”‚  â”‚                â”‚ â”‚tor          â”‚ â”‚                 â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚+ analyze_      â”‚ â”‚+ extract_   â”‚ â”‚+ generate_      â”‚       â”‚
â”‚  â”‚  message()     â”‚ â”‚  entities() â”‚ â”‚  response()     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ConversationService                                     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  + get_or_create_session(phone): Session                 â”‚  â”‚
â”‚  â”‚  + add_message(phone, content, type): Message            â”‚  â”‚
â”‚  â”‚  + get_conversation_history(phone): List[Dict]           â”‚  â”‚
â”‚  â”‚  + pause_for_question(phone): bool                       â”‚  â”‚
â”‚  â”‚  + resume_appointment(phone): Dict                       â”‚  â”‚
â”‚  â”‚  + has_paused_appointment(phone): bool                   â”‚  â”‚
â”‚  â”‚  + process_patient_name(phone, message): Dict            â”‚  â”‚
â”‚  â”‚  + confirm_patient_name(phone, confirmation): Dict       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SmartSchedulingService                                  â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  - calendar_service: GoogleCalendarService               â”‚  â”‚
â”‚  â”‚  - rag_service: RAGService                               â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  + analyze_scheduling_request(message, session): Dict    â”‚  â”‚
â”‚  â”‚  + get_doctor_availability(doctor, days): Dict           â”‚  â”‚
â”‚  â”‚  + _validate_doctor(name): Optional[Dict]                â”‚  â”‚
â”‚  â”‚  + _get_doctor_list_message(): str                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CAMADA DE MODELOS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ConversationSession                                     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  - id: int (PK)                                          â”‚  â”‚
â”‚  â”‚  - phone_number: str                                     â”‚  â”‚
â”‚  â”‚  - current_state: str                                    â”‚  â”‚
â”‚  â”‚  - previous_state: str (nullable)                        â”‚  â”‚
â”‚  â”‚  - patient_name: str (nullable)                          â”‚  â”‚
â”‚  â”‚  - pending_name: str (nullable)                          â”‚  â”‚
â”‚  â”‚  - name_confirmed: bool                                  â”‚  â”‚
â”‚  â”‚  - selected_specialty: str (nullable)                    â”‚  â”‚
â”‚  â”‚  - selected_doctor: str (nullable)                       â”‚  â”‚
â”‚  â”‚  - preferred_date: date (nullable)                       â”‚  â”‚
â”‚  â”‚  - preferred_time: str (nullable)                        â”‚  â”‚
â”‚  â”‚  - created_at: datetime                                  â”‚  â”‚
â”‚  â”‚  - last_activity: datetime                               â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  + update_activity(): void                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â”‚ 1:N                                â”‚
â”‚                            â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ConversationMessage                                     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  - id: int (PK)                                          â”‚  â”‚
â”‚  â”‚  - session: ForeignKey(ConversationSession)              â”‚  â”‚
â”‚  â”‚  - message_type: str (user/bot)                          â”‚  â”‚
â”‚  â”‚  - content: text                                         â”‚  â”‚
â”‚  â”‚  - intent: str (nullable)                                â”‚  â”‚
â”‚  â”‚  - confidence: float (nullable)                          â”‚  â”‚
â”‚  â”‚  - entities: JSONField                                   â”‚  â”‚
â”‚  â”‚  - timestamp: datetime                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Diagrama de Estados da ConversaÃ§Ã£o

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚     idle     â”‚
                        â”‚   (Ocioso)   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                        UsuÃ¡rio inicia
                          conversa
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ collecting_patient_  â”‚
                    â”‚       info           â”‚
                    â”‚ (Coletando dados)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                       Nome informado
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  confirming_name     â”‚
                    â”‚ (Confirmando nome)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                     NÃ£o   â”‚        â”‚ Sim
                           â”‚        â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                       â”‚
          â”‚                                       â–¼
          â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                            â”‚ selecting_specialty  â”‚
          â”‚                            â”‚ (Selecionar espec.)  â”‚
          â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                       â”‚
          â”‚                               Especialidade
          â”‚                                 selecionada
          â”‚                                       â”‚
          â”‚                                       â–¼
          â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                            â”‚  selecting_doctor    â”‚
          â”‚                            â”‚ (Selecionar mÃ©dico)  â”‚
          â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                       â”‚
          â”‚                                  MÃ©dico
          â”‚                                selecionado
          â”‚                                       â”‚
          â”‚                                       â–¼
          â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                            â”‚  choosing_schedule   â”‚
          â”‚                            â”‚ (Escolher horÃ¡rio)   â”‚
          â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                       â”‚
          â”‚                                Data e horÃ¡rio
          â”‚                                 selecionados
          â”‚                                       â”‚
          â”‚                                       â–¼
          â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                            â”‚    confirming        â”‚
          â”‚                            â”‚  (Confirmando)       â”‚
          â”‚                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                             NÃ£o   â”‚        â”‚ Sim
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                                                       â”‚
                                                ConfirmaÃ§Ã£o
                                                   final
                                                       â”‚
                                                       â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ Handoff gerado  â”‚
                                              â”‚ (Fim do fluxo)  â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        SISTEMA DE PAUSAR/RETOMAR (pode ocorrer em              â”‚
â”‚                    qualquer estado)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Qualquer Estado  â”€â”€â”€â”€ DÃºvida do usuÃ¡rio â”€â”€â”€â–º                 â”‚
â”‚                                                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                    â”‚ answering_questions  â”‚                     â”‚
â”‚                    â”‚ (Respondendo dÃºvidas)â”‚                     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                               â”‚                                 â”‚
â”‚                    UsuÃ¡rio diz "continuar"                      â”‚
â”‚                               â”‚                                 â”‚
â”‚                               â–¼                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                    â”‚ Estado anterior      â”‚                     â”‚
â”‚                    â”‚ restaurado           â”‚                     â”‚
â”‚                    â”‚ (Retoma o fluxo)     â”‚                     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ Arquitetura do Sistema

### VisÃ£o Macro da Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ARQUITETURA DO SISTEMA                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    CAMADA DE APRESENTAÃ‡ÃƒO                       â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚  â”‚  â”‚   Paciente   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   WhatsApp Business API  â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  (WhatsApp)  â”‚         â”‚                          â”‚        â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â”‚                                         â”‚                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚                        â”‚
â”‚                                     HTTPS Webhook                    â”‚
â”‚                                             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    CAMADA DE APLICAÃ‡ÃƒO (Django)                 â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚ â”‚
â”‚  â”‚  â”‚   WhatsAppView    â”‚  (Recebe webhooks)                      â”‚ â”‚
â”‚  â”‚  â”‚   (views.py)      â”‚                                         â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚ â”‚
â”‚  â”‚            â”‚                                                    â”‚ â”‚
â”‚  â”‚            â”‚ Valida e processa                                 â”‚ â”‚
â”‚  â”‚            â”‚                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚         GeminiChatbotService (CoreService)               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         (Orquestrador Principal)                         â”‚ â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚  â”‚  â”‚                                                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Coordena:                                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ IntentDetector (Detecta intenÃ§Ãµes)                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ EntityExtractor (Extrai entidades)                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ ResponseGenerator (Gera respostas)                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ SessionManager (Gerencia sessÃµes)                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                          â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚            â”‚                                                    â”‚ â”‚
â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚                      â”‚                  â”‚                  â”‚   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚ConversationService â”‚  â”‚SmartScheduling â”‚  â”‚HandoffServiceâ”‚â”‚ â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚   Service      â”‚  â”‚             â”‚â”‚ â”‚
â”‚  â”‚  â”‚â€¢ GestÃ£o de sessÃµes â”‚  â”‚â€¢ Consulta      â”‚  â”‚â€¢ GeraÃ§Ã£o de â”‚â”‚ â”‚
â”‚  â”‚  â”‚â€¢ HistÃ³rico         â”‚  â”‚  horÃ¡rios      â”‚  â”‚  links      â”‚â”‚ â”‚
â”‚  â”‚  â”‚â€¢ Pausar/Retomar    â”‚  â”‚â€¢ ValidaÃ§Ã£o     â”‚  â”‚  handoff    â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   CAMADA DE INTEGRAÃ‡ÃƒO                          â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚ â”‚
â”‚  â”‚  â”‚  Gemini AI API   â”‚    â”‚ Google Calendar  â”‚                 â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚    â”‚      API         â”‚                 â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Detecta        â”‚    â”‚ â€¢ Consulta       â”‚                 â”‚ â”‚
â”‚  â”‚  â”‚   intenÃ§Ãµes      â”‚    â”‚   disponibilidadeâ”‚                 â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Extrai         â”‚    â”‚ â€¢ Valida horÃ¡riosâ”‚                 â”‚ â”‚
â”‚  â”‚  â”‚   entidades      â”‚    â”‚                  â”‚                 â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Gera respostas â”‚    â”‚                  â”‚                 â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    CAMADA DE DADOS                              â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚
â”‚  â”‚  â”‚          SQLite / PostgreSQL Database          â”‚            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚ â”‚
â”‚  â”‚  â”‚                                                â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ ConversationSession (SessÃµes)               â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ ConversationMessage (Mensagens)             â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ ClinicInfo (Dados da clÃ­nica)              â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Doctor (MÃ©dicos)                            â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Specialty (Especialidades)                  â”‚            â”‚ â”‚
â”‚  â”‚  â”‚                                                â”‚            â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Fluxo de Dados Simplificado

```
Mensagem â†’ WhatsApp API â†’ Django View â†’ Agent Router (CoreService) 
                                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚                         â”‚
             Intent Detector          Entity Extractor         Response Generator
                    â”‚                         â”‚                         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                    Resposta Contextual
                                              â”‚
                                              â–¼
                                   WhatsApp API â†’ UsuÃ¡rio
```

---

## ğŸ“ˆ MÃ©tricas e Performance

### Indicadores de Qualidade

| MÃ©trica | Valor | DescriÃ§Ã£o |
|---------|-------|-----------|
| **Taxa de CompreensÃ£o** | ~85-90% | Percentual de intenÃ§Ãµes corretamente identificadas |
| **Tempo de Resposta** | < 3s | Tempo mÃ©dio de processamento e resposta |
| **Taxa de Handoff** | ~70% | Percentual de conversas que completam o fluxo |
| **Disponibilidade** | 99.5% | Uptime do sistema |
| **AcurÃ¡cia de ExtraÃ§Ã£o** | ~80% | PrecisÃ£o na extraÃ§Ã£o de entidades |

### OtimizaÃ§Ãµes Implementadas

1. **Cache de Dados da ClÃ­nica**: Reduz chamadas ao banco de dados
2. **Processamento AssÃ­ncrono**: Webhooks processados em background
3. **ModularizaÃ§Ã£o**: Facilita manutenÃ§Ã£o e escalabilidade
4. **GestÃ£o Inteligente de Tokens**: Otimiza uso da API do Gemini
5. **Tratamento de Erros**: Sistema robusto de logging e mensagens genÃ©ricas em caso de falha

---

## ğŸ” SeguranÃ§a e Privacidade

### Medidas de SeguranÃ§a Implementadas

- **ValidaÃ§Ã£o de Webhooks**: VerificaÃ§Ã£o de assinatura do WhatsApp
- **HTTPS obrigatÃ³rio**: Todas as comunicaÃ§Ãµes sÃ£o criptografadas
- **SanitizaÃ§Ã£o de Dados**: ValidaÃ§Ã£o e limpeza de inputs
- **GestÃ£o de Chaves API**: VariÃ¡veis de ambiente seguras
- **Logs AuditÃ¡veis**: Rastreabilidade de todas as interaÃ§Ãµes

### Conformidade com LGPD

- Dados pessoais armazenados apenas o necessÃ¡rio
- PolÃ­tica de retenÃ§Ã£o de dados definida
- Consentimento implÃ­cito ao usar o serviÃ§o
- Direito ao esquecimento implementÃ¡vel

---

## ğŸš€ Deployment e Infraestrutura

### Ambientes

- **Desenvolvimento**: Local com SQLite
- **Staging**: Servidor de testes
- **ProduÃ§Ã£o**: Cloud com PostgreSQL

### Stack TecnolÃ³gico

```
Frontend (Cliente):  WhatsApp App
Backend:             Python 3.11 + Django 4.2
Database:            SQLite (dev) / PostgreSQL (prod)
IA/ML:               Google Gemini AI
Cache:               Django Cache Framework
Queue:               (Futuro: Celery + Redis)
Deploy:              (A definir: Heroku/AWS/GCP)
```

---

## ğŸ“– GlossÃ¡rio

| Termo | DefiniÃ§Ã£o |
|-------|-----------|
| **Agent Router** | Componente que analisa mensagens e direciona para serviÃ§os especializados |
| **Intent (IntenÃ§Ã£o)** | O objetivo ou propÃ³sito de uma mensagem do usuÃ¡rio |
| **Entity (Entidade)** | InformaÃ§Ã£o especÃ­fica extraÃ­da da mensagem (nome, data, etc.) |
| **LLM** | Large Language Model - Modelo de linguagem de grande porte |
| **Handoff** | TransferÃªncia de atendimento do bot para humano |
| **RAG** | Retrieval-Augmented Generation - GeraÃ§Ã£o aumentada por recuperaÃ§Ã£o |
| **Webhook** | Endpoint HTTP que recebe notificaÃ§Ãµes de eventos |
| **Session** | SessÃ£o de conversaÃ§Ã£o persistente de um usuÃ¡rio |
| **State Machine** | MÃ¡quina de estados que gerencia fluxo de conversaÃ§Ã£o |

---

## ğŸ“š ReferÃªncias

1. **DocumentaÃ§Ã£o Django**: https://docs.djangoproject.com/
2. **WhatsApp Business API**: https://developers.facebook.com/docs/whatsapp
3. **Google Gemini AI**: https://ai.google.dev/
4. **Google Calendar API**: https://developers.google.com/calendar
5. **PadrÃµes de Arquitetura de Software**: Martin Fowler
6. **Design Patterns**: Gang of Four
7. **Clean Architecture**: Robert C. Martin

---

## ğŸ‘¥ Autoria e ContribuiÃ§Ãµes

**Desenvolvedor Principal**: [Seu Nome]  
**Orientador**: [Nome do Orientador]  
**InstituiÃ§Ã£o**: [Nome da InstituiÃ§Ã£o]  
**PerÃ­odo**: 2024-2025

---

## ğŸ“„ LicenÃ§a

Este projeto foi desenvolvido como Trabalho de ConclusÃ£o de Curso (TCC) e estÃ¡ sujeito Ã s polÃ­ticas acadÃªmicas da instituiÃ§Ã£o de ensino.

---

**Ãšltima atualizaÃ§Ã£o**: Novembro de 2025  
**VersÃ£o da DocumentaÃ§Ã£o**: 1.0  
**Status**: âœ… Completa e Atualizada


